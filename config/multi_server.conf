# Multi-server configuration with different website themes
# Port 8080: Main Website Server
server {
    listen 8080
    host localhost
    server_name main_website
    client_max_body_size 10M
    root www-main
	error_page 400 /error/400.html
    error_page 404 /error/404.html
    error_page 403 /error/403.html
    error_page 500 /error/500.html
    error_page 502 /error/502.html
    
    # Main website with full functionality
    location / {
        allow_methods GET POST PUT DELETE
        default index.html
        autoindex off
    }
    
    # File uploads
    location /upload/ {
        allow_methods POST PUT
        upload_path www-main/uploads
        client_max_body_size 50M
    }
    
    # Browse uploaded files
    location /uploads {
        allow_methods GET
        root www-main/uploads
        autoindex on
    }
    
    # CGI scripts
    location /cgi-bin {
        allow_methods GET POST
        root www-main/cgi-bin
        autoindex off
    }
    
    # Python CGI support  
    location ~ \.py$ {
        allow_methods GET POST
        cgi_extensions .py
        cgi_path /usr/bin/python3
    }
    
    # Shell CGI support
    location ~ \.sh$ {
        allow_methods GET POST
        cgi_extensions .sh
        cgi_path /bin/bash
    }

	# PHP CGI support
	location ~ \.php$ {
		allow_methods GET POST
		cgi_extensions .php
		cgi_path /usr/bin/php-cgi
	}
}

# Port 8081: API Server (JSON-focused)
server {
    listen 8081
    host localhost
    server_name api_server
    client_max_body_size 5M
    root www-api
    error_page 404 /error/404.html
    
    # API root with directory listing
    location / {
        allow_methods GET POST PUT DELETE
        default index.html
        autoindex on
    }
    
    # API endpoints with JSON focus
    location /api {
        allow_methods GET POST PUT DELETE
        root www-api/api
        default test.json
        autoindex on
    }
    
    # Restrict to API methods only
    location /files {
        allow_methods GET
        root www-api/files
        autoindex on
    }
}

# Port 8082: File Server (Download/Upload focused)
server {
    listen 8082
    host localhost
    server_name file_server
    client_max_body_size 100M
    root www-files
    error_page 404 /error/404.html
    
    # File server root - directory listing enabled
    location / {
        allow_methods GET
        default index.html
        autoindex on
    }
    
    # Files directory with listing
    location /files {
        allow_methods GET
        root www-files/files
        autoindex on
    }
    
    # Upload functionality
    location /upload/ {
        allow_methods POST PUT
        upload_path www-files/uploads
        client_max_body_size 100M
    }
    
    # Browse uploads
    location /uploads {
        allow_methods GET
        root www-files/uploads
        autoindex off
    }
    
    location /js {
        allow_methods GET
        root www/js
        autoindex off
    }
}

# Port 8083: Development Server (CGI-focused)
server {
    listen 8083
    host localhost
    server_name dev_server
    client_max_body_size 10M
    root www-dev
    error_page 404 /error/404.html
    error_page 500 /error/500.html
    
    # Development root with directory browsing
    location / {
        allow_methods GET POST
        default index.html
        autoindex on
    }
    
    # CGI development area
    location /cgi-bin {
        allow_methods GET POST
        root www-dev/cgi-bin
        autoindex on
    }
    
    # Error pages for testing
    location /error {
        allow_methods GET
        root www-dev/error
        autoindex on
    }
    
    # Python CGI support  
    location ~ \.py$ {
        allow_methods GET POST
        cgi_extensions .py
        cgi_path /usr/bin/python3
    }
    
    # Shell CGI support
    location ~ \.sh$ {
        allow_methods GET POST
        cgi_extensions .sh
        cgi_path /bin/bash
    }

	# PHP CGI support
	location ~ \.php$ {
		allow_methods GET POST
		cgi_extensions .php
		cgi_path /usr/bin/php-cgi
	}
}